#!/usr/bin/env python3
"""
edge-tts를 사용하여 Agent Skills Guide의 음성 해설을 생성합니다.

사용법:
  pip install edge-tts
  python generate-audio.py

음성 옵션:
  - ko-KR-YuJinNeural: 여성, 또렷한 발음 (현재 사용)
  - ko-KR-SunHiNeural: 여성, 자연스럽고 따뜻한 음성
  - ko-KR-InJoonNeural: 남성, 자연스러운 음성
  - ko-KR-HyunsuNeural: 남성, 밝은 톤
"""

import asyncio
import os
import edge_tts

# 설정
VOICE = "ko-KR-YuJinNeural"  # 여성, 또렷한 발음
OUTPUT_DIR = "../public/audio/ko"
RATE = "-5%"  # 약간 느리게 (학습용)

# 섹션별 음성 스크립트 (audioTranscripts.ts에서 추출)
TRANSCRIPTS = {
    "what-are-skills": """
스킬이란 무엇일까요?
클로드를 사용하면서 매번 같은 설명을 반복해야 하나라는 생각을 해보신 적 있으신가요?
스킬은 바로 이 문제를 해결합니다. 스킬은 클로드에게 특정 작업을 수행하는 방법을 가르치는 레시피와 같습니다.
마치 요리책의 레시피처럼, 스킬은 클로드가 따라야 할 단계별 지시사항을 담고 있어서, 한 번 만들어 두면 매번 일관된 품질의 결과를 얻을 수 있습니다.
스킬의 핵심 가치는 다섯 가지입니다.
첫째, 재사용성. 한 번 작성하면 무한히 재사용할 수 있습니다.
둘째, 일관성. 매번 동일한 품질과 형식의 결과를 보장합니다.
셋째, 공유 가능성. 팀원들과 쉽게 공유하고 협업할 수 있습니다.
넷째, 확장성. MCP 서버와 결합하여 외부 도구까지 활용할 수 있습니다.
다섯째, 이식성. 모든 클로드 환경에서 동일하게 동작합니다.
""",

    "who-is-this-for": """
이 가이드는 누구를 위한 것일까요?
이 가이드는 클로드의 스킬 기능을 처음 접하는 분부터 고급 활용법을 원하는 분까지, 모든 수준의 사용자를 대상으로 합니다.
비개발자 분들도 걱정하지 마세요. 스킬을 만드는 데 프로그래밍 지식이 필수는 아닙니다. 기본적인 스킬은 마크다운과 YAML만 알면 충분합니다.
반면, 개발자라면 MCP 통합, API 연동, 자동화 파이프라인 구축 등 더 강력한 기능을 활용할 수 있습니다.
이 가이드는 클로드닷에이아이 사용자, 클로드 코드 사용자, 그리고 API 개발자 모두를 위한 내용을 담고 있습니다.
""",

    "two-paths": """
스킬 생성에는 두 가지 경로가 있습니다.
첫 번째는 인터랙티브 방식입니다. 클로드와 대화하면서 스킬 크리에이터 도구의 도움을 받아 자연스럽게 스킬을 만들어 나갑니다.
복잡한 구문을 몰라도 클로드가 안내해 주기 때문에, 처음 스킬을 만드는 분들에게 적합합니다.
두 번째는 직접 생성 방식입니다. YAML 프론트매터와 마크다운 지시사항을 직접 작성하여 스킬 폴더를 구성합니다.
세밀한 제어가 필요하거나 버전 관리, 팀 협업이 필요한 경우에 적합합니다.
어떤 방식을 선택하든 스킬의 구조와 원리는 동일합니다. 처음에는 인터랙티브 방식으로 시작하고, 익숙해지면 직접 생성 방식으로 전환하는 것을 권장합니다.
""",

    "what-is-a-skill": """
스킬의 구조를 알아보겠습니다.
스킬은 본질적으로 클로드에게 특정 작업 수행 방법을 가르치는 지시사항 패키지입니다.
모든 스킬의 핵심에는 SKILL.md 파일이 있습니다. 이 파일은 스킬의 모든 것을 정의하는 설계도입니다.
SKILL.md는 두 부분으로 구성됩니다.
첫 번째는 YAML 프론트매터로, 대시 세 개로 감싸진 메타데이터 영역입니다. 여기에는 스킬 이름, 설명, 사용할 도구 목록 등이 들어갑니다.
두 번째는 마크다운 본문으로, 클로드가 따라야 할 상세 지시사항이 담깁니다.
프로그레시브 디스클로저라는 중요한 개념이 있습니다. 이는 정보를 필요한 시점에 필요한 만큼만 로드하는 방식입니다.
티어 원은 YAML 프론트매터로 항상 로드됩니다. 티어 투는 SKILL.md 본문으로 관련 시에만 로드됩니다.
티어 쓰리는 레퍼런스 폴더의 파일들로 참조 시에만 로드됩니다.
""",

    "core-design-principles": """
핵심 설계 원칙을 살펴보겠습니다.
효과적인 스킬을 만들기 위해 공식 가이드에서 제시하는 세 가지 핵심 원칙이 있습니다.
첫째, 프로그레시브 디스클로저입니다. 작게 시작해서 점진적으로 확장하세요.
모든 정보를 한 번에 로드하는 대신 필요한 시점에 관련 정보만 가져오는 것이 핵심입니다.
둘째, 코드로서의 지시사항입니다. 스킬 지시사항을 코드베이스처럼 취급하세요.
버전 관리, 변경 이력 추적, 동료 리뷰, 롤백 기능 등 코드 관리의 모든 장점을 활용할 수 있습니다.
셋째, 에러 처리입니다. 실패를 우아하게 처리하는 것은 스킬 품질의 핵심입니다.
예상 가능한 에러에 대한 명확한 지침을 제공하세요.
""",

    "mcp-and-skills": """
MCP와 스킬의 관계를 알아보겠습니다.
MCP, 즉 모델 컨텍스트 프로토콜은 클로드가 외부 세계와 상호작용할 수 있게 해주는 표준화된 프로토콜입니다.
스킬과 MCP는 서로 보완적인 관계입니다.
MCP 서버가 도구를 제공하면, 스킬은 그 도구를 언제, 어떻게 사용할지의 지능을 제공합니다.
예를 들어, GitHub MCP 서버는 이슈를 생성하고 PR을 관리하는 도구를 제공합니다.
반면 PR 리뷰 스킬은 그 도구들을 사용하여 어떤 파일을 검토하고 어떤 피드백을 제공할지의 지능을 제공합니다.
스킬은 MCP 없이도 독립적으로 동작할 수 있습니다. MCP가 있으면 스킬의 능력이 크게 확장됩니다.
""",

    "skill-creator-wizard": """
스킬 생성 위저드에 오신 것을 환영합니다.
이 위저드를 사용하면 단계별로 스킬을 구성하고, 완성된 YAML 파일을 바로 복사할 수 있습니다.
첫 번째 단계에서는 스킬의 이름과 설명을 입력합니다. 이 정보는 클로드가 스킬을 인식하는 데 사용됩니다.
두 번째 단계에서는 스킬에서 사용할 도구를 선택합니다. 필요한 도구만 선택하면 보안과 성능이 향상됩니다.
세 번째 단계에서는 스킬의 지시사항을 작성합니다. 마크다운 형식을 사용할 수 있습니다.
마지막 단계에서는 생성된 YAML을 확인하고 복사합니다. 선택한 플랫폼에 맞는 형식으로 제공됩니다.
""",
}


async def generate_audio(section_key: str, text: str) -> None:
    """단일 섹션의 음성을 생성합니다."""
    output_path = os.path.join(OUTPUT_DIR, f"{section_key}.mp3")

    # 텍스트 정리
    clean_text = " ".join(text.strip().split())

    print(f"생성 중: {section_key}...")

    communicate = edge_tts.Communicate(clean_text, VOICE, rate=RATE)
    await communicate.save(output_path)

    print(f"완료: {output_path}")


async def main():
    """모든 섹션의 음성을 생성합니다."""
    # 출력 디렉토리 생성
    os.makedirs(OUTPUT_DIR, exist_ok=True)

    print(f"음성: {VOICE}")
    print(f"출력: {OUTPUT_DIR}")
    print(f"섹션 수: {len(TRANSCRIPTS)}")
    print("-" * 40)

    # 순차적으로 생성 (병렬 생성 시 rate limit 문제 방지)
    for section_key, text in TRANSCRIPTS.items():
        await generate_audio(section_key, text)

    print("-" * 40)
    print(f"총 {len(TRANSCRIPTS)}개의 음성 파일이 생성되었습니다.")


if __name__ == "__main__":
    asyncio.run(main())
